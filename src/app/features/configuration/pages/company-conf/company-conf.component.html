<div class="company-container">
    <button class="btn-back" (click)="goBack()">
        <span class="material-icons">arrow_back</span>
        Volver
    </button>
    
    <div class="company-card">
        <div class="company-header">
            <div class="logo-container">
                <img *ngIf="company.imgBase64" 
                     [src]="'data:image/png;base64,' + company.imgBase64" 
                     class="company-logo" 
                     alt="Logo de la empresa">
                <div *ngIf="!company.imgBase64" class="logo-placeholder">
                    <span class="material-icons">business</span>
                </div>
            </div>
            
            <div class="company-titles">
                <h2>{{company.companyName || 'Nombre de la empresa'}}</h2>
                <p class="company-subtitle">Configuración de la empresa</p>
            </div>
            
            <button (click)="openEditModal()" 
                    class="btn-primary" 
                    [disabled]="isLoading">
                Editar
            </button>
        </div>
        
        <div class="company-info">
            <div class="info-row">
                <span class="info-label">NIT:</span>
                <span class="info-value">{{company.nit || 'No especificado'}}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Dirección:</span>
                <span class="info-value">{{company.address || 'No especificada'}}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Teléfono:</span>
                <span class="info-value">{{company.phoneNumber || 'No especificado'}}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Email:</span>
                <span class="info-value">{{company.email || 'No especificado'}}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Estado:</span>
                <span class="info-value">{{company.status === 'A' ? 'Activo' : 'Inactivo'}}</span>
            </div>
        </div>
    </div>
</div>

<div *ngIf="showModal" class="modal-overlay">
    <div class="modal-content">
        <h2>Editar Información de la Empresa</h2>
        
        <form class="company-form" (ngSubmit)="saveCompany()">
            <div class="form-row">
                <div class="form-group">
                    <label>Nombre de la Empresa <span class="required">*</span></label>
                    <input type="text" [(ngModel)]="tempCompany.companyName" name="companyName" required>
                </div>
                
                <div class="form-group">
                    <label>NIT <span class="required">*</span></label>
                    <input type="text" [(ngModel)]="tempCompany.nit" name="nit" required
                           maxlength="{{MAX_NIT_LENGTH}}"
                           (input)="handleInput('nit', MAX_NIT_LENGTH, $event)">
                    <div class="char-counter">
                        Caracteres restantes: {{ MAX_NIT_LENGTH - (tempCompany.nit?.length || 0) }}
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Dirección <span class="required">*</span></label>
                    <input type="text" [(ngModel)]="tempCompany.address" name="address" required
                           maxlength="{{MAX_ADDRESS_LENGTH}}"
                           (input)="handleInput('address', MAX_ADDRESS_LENGTH, $event)">
                    <div class="char-counter">
                        Caracteres restantes: {{ MAX_ADDRESS_LENGTH - (tempCompany.address?.length || 0) }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Teléfono <span class="required">*</span></label>
                    <input type="text" [(ngModel)]="tempCompany.phoneNumber" name="phoneNumber" required
                           maxlength="{{MAX_PHONE_LENGTH}}"
                           (keypress)="validateNumber($event)"
                           (input)="handleInput('phoneNumber', MAX_PHONE_LENGTH, $event)">
                    <div *ngIf="formSubmitted && tempCompany.phoneNumber?.length !== MAX_PHONE_LENGTH" 
                         class="error-message">
                        El teléfono debe tener exactamente {{MAX_PHONE_LENGTH}} dígitos
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Email <span class="required">*</span></label>
                <input type="email" [(ngModel)]="tempCompany.email" name="email" required
                       maxlength="{{MAX_EMAIL_LENGTH}}"
                       (input)="handleInput('email', MAX_EMAIL_LENGTH, $event)">
                <div class="char-counter">
                    Caracteres restantes: {{ MAX_EMAIL_LENGTH - (tempCompany.email?.length || 0) }}
                </div>
            </div>

            <div class="form-group">
                <label>Logo de la Empresa <span class="required">*</span></label>
                <div class="upload-container">
                    <div class="image-preview">
                        <img *ngIf="tempCompany.imgBase64" 
                             [src]="'data:image/png;base64,' + tempCompany.imgBase64" 
                             alt="Vista previa del logo">
                        <div *ngIf="!tempCompany.imgBase64" class="logo-placeholder">
                            <span class="material-icons">business</span>
                        </div>
                    </div>
                    
                    <div class="upload-controls">
                        <input type="file" id="companyLogo" 
                               (change)="onImageUpload($event)" 
                               accept="image/*" hidden>
                        <label for="companyLogo" class="btn-upload">
                            <span class="material-icons">upload</span>
                            Cambiar logo
                        </label>
                        <small>Tamaño máximo: 2MB (JPEG, PNG, JPG)</small>
                        <div *ngIf="formSubmitted && !tempCompany.imgBase64" class="error-message">
                            El logo de la empresa es obligatorio
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-submit" [disabled]="isLoading">
                    {{ isLoading ? 'Guardando...' : 'Guardar Cambios' }}
                </button>
                <button type="button" class="btn-cancel" (click)="cancelEdit()" [disabled]="isLoading">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>


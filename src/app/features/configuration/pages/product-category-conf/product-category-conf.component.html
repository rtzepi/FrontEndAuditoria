<div class="container">
    <button class="btn-back" (click)="goBack()">
        <span class="material-icons">arrow_back</span>
        Volver
    </button>

    <div class="header">
        <h2>Categorías de Productos</h2>
        <div class="header-actions">
            <app-input-search
                placeholder="Buscar categoría..."
                (searchChange)="handleSearch($event)">
            </app-input-search>
            <button (click)="openAddCategoryModal()" class="btn btn-primary add-category-btn" [disabled]="isLoading">
                <span class="material-icons">add</span>
            </button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Categoría</th>
                <th>Descripción</th>
                <th>Fecha de Creación</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let category of paginatedCategories">
                <td>{{category.idCategory}}</td>
                <td>{{ category.categoryName }}</td>
                <td>{{ category.description }}</td>
                <td>{{ category.created_at | date:'dd/MM/yyyy HH:mm:ss' }}</td>
                <td>{{ category.status }}</td>
                <td class="btn-actions">
                    <button class="btn btn-info" (click)="openEditCategoryModal(category)" [disabled]="isLoading">Editar</button>
                    <button class="btn btn-danger" (click)="confirmDelete(category)" [disabled]="isLoading">Eliminar</button>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="pagination-controls" *ngIf="categories.length > itemsPerPage">
        <button (click)="previousPage()" [disabled]="currentPage === 1" class="btn-pagination">
            Anterior
        </button>
        <span>Página {{currentPage}} de {{totalPages}}</span>
        <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="btn-pagination">
            Siguiente
        </button>
    </div>
</div>

<!-- Modal para agregar/editar categoría -->
<div *ngIf="showModal" class="modal-overlay">
    <div class="modal-content">
        <h2>{{ isEditing ? 'Editar Categoría' : 'Agregar Categoría' }}</h2>
        
        <form #categoryForm="ngForm" (ngSubmit)="isEditing ? updateCategory() : addCategory()" class="category-form">
            <div class="form-group">
                <label>Categoría: <span class="required">*</span></label>
                <input type="text" [(ngModel)]="newCategory.categoryName" name="category" 
                    placeholder="Ej: Iluminación" required #category="ngModel" 
                    maxlength="30" />
                
                <div class="char-counter" [class.near-limit]="(category.value?.length || 0) > 25">
                    {{ category.value?.length || 0 }}/30 caracteres
                </div>
                
                <div *ngIf="category.invalid && (category.dirty || category.touched)" class="error-message">
                    La categoría es requerida
                </div>
            </div>
            
            <div class="form-group">
                <label>Descripción:</label>
                <textarea [(ngModel)]="newCategory.description" name="description" 
                    placeholder="Ej: Focos, lámparas, etc." #description="ngModel"
                    maxlength="60"></textarea>
        
            <div class="char-counter" [class.near-limit]="(description.value?.length || 0) > 50">
                {{ description.value?.length || 0 }}/60 caracteres
            </div>
        </div>
            
            <div class="form-group">
                <label>Estado: <span class="required">*</span></label>
                <select [(ngModel)]="newCategory.status" name="status" required #status="ngModel">
                    <option value="E">Activo</option>
                    <option value="D">Inactivo</option>
                </select>
                <div *ngIf="status.invalid && (status.dirty || status.touched)" class="error-message">
                    El estado es requerido
                </div>
            </div>

            <div class="modal-actions">
                <button type="submit" 
                        class="btn-submit"
                        [disabled]="categoryForm.invalid || isLoading">
                    {{ isLoading ? (isEditing ? 'Actualizando...' : 'Guardando...') : (isEditing ? 'Actualizar' : 'Guardar') }}
                </button>
                <button type="button" 
                        class="btn-cancel"
                        (click)="closeModal()"
                        [disabled]="isLoading">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>